<source>
  @type tail
  @id containers_log
  path "/var/log/containers/*.log"
  pos_file "/var/log/custom-containers.log.pos"
  tag "kubernetes.*"
  exclude_path []
  read_from_head true
  <parse>
    @type "regexp"
    expression /^(?<time>[^ ]+) (?<stream>stdout|stderr) (F|P) (?<log>.*)$/
  </parse>
</source>
<filter kubernetes.**>
  @type kubernetes_metadata
  @id filter_kube_metadata
  kubernetes_url "https://10.96.0.1:443/api"
  verify_ssl true
  ca_file ""
  skip_labels false
  skip_container_metadata false
  skip_master_url false
  skip_namespace_metadata false
  watch true
</filter>
<match **>
  @type elasticsearch
  @id out_es
  @log_level "info"
  include_tag_key true
  host "#{ENV['FLUENT_ELASTICSEARCH_HOST']}"
  port "#{ENV['FLUENT_ELASTICSEARCH_PORT']}"
  path ""
  scheme "#{ENV['FLUENT_ELASTICSEARCH_SCHEME']}"
  ssl_verify "#{ENV['FLUENT_ELASTICSEARCH_SSL_VERIFY']}"
  ssl_version "#{ENV['FLUENT_ELASTICSEARCH_SSL_VERSION']}"
  user "#{ENV['FLUENT_ELASTICSEARCH_USER']}"
  password "#{ENV['FLUENT_ELASTICSEARCH_PASSWORD']}"
  reload_connections false
  reconnect_on_error true
  reload_on_failure true
  log_es_400_reason false
  logstash_prefix "logstash"
  logstash_dateformat "%Y.%m.%d"
  logstash_format true
  index_name "logstash"
  target_index_key
  type_name "fluentd"
  include_timestamp false
  template_name
  template_file
  template_overwrite false
  sniffer_class_name "Fluent::Plugin::ElasticsearchSimpleSniffer"
  request_timeout 5s
  application_name default
  <buffer>
    flush_thread_count 8
    flush_interval 5s
    chunk_limit_size 2M
    queue_limit_length 32
    retry_max_interval 30
    retry_forever true
  </buffer>
</match>
