http {
  server {
    listen 3000 ssl;
    server_name _grafana.piny940.com;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_certificate     /run/secrets/tls.crt;
    ssl_certificate_key /run/secrets/tls.key;

    location / {
      proxy_pass http://grafana:3000;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_cache_bypass $http_upgrade;
    }
  }

  upstream stg-prometheus {
    server procyon.home.local:30007;
  }
  server {
    listen 3001;
    location / {
      proxy_pass http://stg-prometheus;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_cache_bypass $http_upgrade;
    }
  }

  upstream prometheus {
    server betelgeuse.home.local:30007;
    server bellatrix.home.local:30007;
    server rigel.home.local:30007;
  }
  server {
    listen 3002;
    location / {
      proxy_pass http://prometheus;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_cache_bypass $http_upgrade;
    }
  }

  server {
    listen 3003 ssl;
    server_name _kibana.piny940.com;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_certificate     /run/secrets/tls.crt;
    ssl_certificate_key /run/secrets/tls.key;

    location / {
      proxy_pass http://kibana:5601;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_cache_bypass $http_upgrade;
    }
  }
}
events {
  worker_connections 1024;
}
