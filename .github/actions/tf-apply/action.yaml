inputs:
  env:
    description: "Environment to deploy to"
    required: true
  google_credentials:
    description: "Slack webhook URL"
    required: true
runs:
  using: composite
  steps:
    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v3
    - name: Terraform Init
      run: cd terraform/${{ inputs.env }} && terraform init
      shell: bash
      env:
        GOOGLE_CREDENTIALS: ${{ inputs.google_credentials }}
    - name: Terraform Plan
      run: cd terraform/${{ inputs.env }} && terraform plan -no-color -input=false > plan.txt
      shell: bash
      env:
        GOOGLE_CREDENTIALS: ${{ inputs.google_credentials }}
    - name: Terraform Apply
      run: cd terraform/${{ inputs.env }} && terraform apply -auto-approve
      id: tf-apply
      shell: bash
      env:
        GOOGLE_CREDENTIALS: ${{ inputs.google_credentials }}
